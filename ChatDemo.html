<html>
<head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
    <meta charset="utf-8">
    <title>RTCStar</title>
    <meta content="width=device-width, initial-scale=1.0" name="viewport">
    <meta content="" name="description">
    <meta content="elemind.com" name="author">
    <link href="./About_files/style.css" rel="stylesheet">


    <script src="./About_files/modernizr.min.js" style=""></script>

</head>
<body class="about" data-spy="scroll" data-target=".documentation-nav">
    <div class="container">
        <div class="row">

            <!-- .................................... $header .................................... -->
            <header class="span3">
                <div class="affix">
                    <div class="navbar span3">
                        <div class="navbar-inner">
                            <a class="btn btn-navbar" data-target=".nav-collapse" data-toggle="collapse">
                                <i class="icon-reorder"></i>
                            </a>
                            <a class="brand span2" href="index.html">
                                <img alt="" src="./img/logo.png">
                            </a>
                            <nav class="nav-collapse collapse">
                                <ul class="nav">
                                    <li class="nav-home "><a href="index.html">Home</a></li>
                                   
                                    <li class="dropdown nav-portfolio">
                                        <a class="dropdown-toggle" data-toggle="dropdown" href="./About_files/About.html">
                                            Usage example
                                            <b class="caret"></b>
                                        </a>
                                        <ul class="dropdown-menu">
                                            <li class="nav-portfolio-2 "><a href="ChatUsage.html">Chat tutorial</a></li>
                                        </ul>
                                    </li>
                                    
                                    <li class="dropdown nav-portfolio">
                                        <a class="dropdown-toggle" data-toggle="dropdown" href="./About_files/About.html">
                                            Demo
                                            <b class="caret"></b>
                                        </a>
                                        <ul class="dropdown-menu">
                                            <li class="nav-portfolio-2 active"><a href="ChatDemo.html">Chat </a></li>
                                        </ul>
                                    </li>
                                    
                                    <li class="nav-home"><a href="API.html">API</a></li>
                                </ul>
                            </nav>
                        </div><!-- /navbar-inner -->
                    </div><!-- /navbar -->
                </div><!-- /affix -->
            </header>

            <div class="main span9">

    <!-- .................................... $About .................................... -->
    <section class="section-content section-about" id="section-about">
        <h2 class="section-title">
            Chat Demo Example
            <small style="text-transform:none">
                1. Click start server to get a server id, a client will automatically be created. </br>
                2. Open another browser instance, paste the server id from the previous tab and join the server </br>
                3. Start sending messages!
            </small>

        </h2>

       <h2> Start Server or Client </h2>
        </br>

        <b id='created_id'> Server Id =  </b> 
        <button class="btn btn-small" id ="start_server"> Start server </button> </br></br>

        <b> Join room ID =  </b><input id="server_id"> </input> 
        <button class="btn btn-small" id="join_server"> Join  Server </button></br></br>



        <div id="chat_box">
            Chat will be shown below
            <precode>
                <ul id="chat_message"> 
                </ul>
            </precode>
            <input id="txt_msg"></input>
            <button class="btn btn-small" id="btn_sendmsg">Send Message</button>
        </div>  
    
    </section>
            </div><!-- /main span9 -->

        </div><!-- /row -->
    </div><!-- /container -->

    <!-- .................................... $scripts .................................... -->
    <script src="./About_files/jquery.min.js"></script>
     <!--<script src="./About_files/js"></script>
    <script src="./About_files/jquery.ui.map.min.js"></script> -->
    <script src="./About_files/bootstrap.min.js"></script>
    <!--<script src="./About_files/jquery.fancybox.min.js"></script>
    <script src="./About_files/jquery.hoverdir.min.js"></script>
    <script src="./About_files/jquery.isotope.min.js"></script>
    <script src="./About_files/jquery.masonry.min.js"></script>
    <script src="./About_files/jquery.fitvids.min.js"></script>
    <script src="./About_files/jquery.flexslider.min.js"></script>
    <script src="./About_files/jquery.imagesloaded.min.js"></script>
    <script src="./About_files/cbpBGSlideshow.min.js"></script>
    <script src="./About_files/script.js"></script> -->

    <!-- RTC Star library -->
    <script src="js/RTCStarJS/adapter.js"></script>
    <script src="js/RTCStarJS/peer.js"></script>
    <script src="js/RTCStarJS/RTCStarClient.js"></script>
    <script src="js/RTCStarJS/RTCStarServer.js"></script>

    <!-- plugins -->
    <script src="js/RTCStarJS/plugin/ChatClient.js"></script>
    <script src="js/RTCStarJS/plugin/ChatServer.js"></script>

    <script>

        var chatWidgetClient;
        var videoWidgetClient; 

        $('#video_chat').hide();

        $('#start_server').click(function(){
            initServer();
        })

        $('#join_server').click(function() {
            var server_id = $('#server_id').val();
            initClient(server_id);
        })

        $('#btn_sendmsg').click(function(){
            var message = $('#txt_msg').val();
            chatWidgetClient.sendchat(message);
        })

        function initServer(){
            //server creation code 
            var server = new RTCStarServer();

            //setting up widget necessary
            var chatWidgetServer = new ChatWidgetServer(server);
            
            //starting the server 
            server.start();

            server.onServerEvent('Open',function(server_id){
                $('#created_id').text('Server Id = '+server_id);
                initClient(server_id);
                $('#server_id').val(server_id);
            });
            
        }

        function initClient(server_id){
            var client = new RTCStarClient();

            //setting up widget necessary
            chatWidgetClient = new ChatWidgetClient(client);

            //  UI update
            configChat(chatWidgetClient);

            //starting the client 
            client.start(server_id);
        }

        function configChat(chatWidgetClient){
            //show video and chat
            $('#video_chat').show();
            var chatController = new Object();
            chatController.onMessage = function(message){
                if (message.subType == "Init"){
                    for (var i in message.data){
                        $('#chat_message').append('<li>' + message.data[i].peerId + ' : ' + message.data[i].text + '</li>');
                    }
                } else if (message.subType == "NewChat")
                    $('#chat_message').append('<li>' + message.peerId + ' : ' + message.text + '</li>');
            }

            chatController.onOpen = function(peerId){
                 $('#join_server').text("Join server done ("+ peerId+")");
                 var welcomeMessage = "I'm in!";
                 chatWidgetClient.sendchat(welcomeMessage);   
            }


            chatWidgetClient.setdelegate(chatController);
        }

    </script>

</body>

</html>